<script type="text/javascript">
var commonQuery = JL.JLForm();

commonQuery.setAfterInit(function(){
	var sqlMap = JLQuery["config"]["sqlMap"];
	
	commonQuery.getTab().find(".modal_content").css({"height": "90%", "max-height": "90%"});
	
	if(!JL.isNull(sqlMap.title)){
		commonQuery.getTab().find(".modal_title > h3").html(sqlMap.title);
	}

	var buttons = [{
		text:"查找",
		func:function(){
			commonQuery.query();
		}
	},{
		text:"确定",
		func:function(){
			commonQuery.callback();
		}
	}];


	var queryGridConfig = {
		"jlid" : "JLLayoutGrid_mobile",
		"resource" : "WORKFLOW",
		"header": sqlMap.result
	};
	

	queryGridConfig.listener={};
	queryGridConfig.listener.rowclick = function(data){
		commonQuery.callback(data);
	 };

	var pluginObj = JL.initPlugIn(commonQuery.getTab().find("#d_querygrid"), "querygrid", queryGridConfig, null, null, null, commonQuery)
	commonQuery.setPluginObj({"querygrid": pluginObj});
	
	if(!JL.isNull(sqlMap.page)){
	    	commonQuery.getTab().find("#queryField").show();
	    	commonQuery.getTab().find("#queryField").load(sqlMap.page+"?rid"+JL.random(), function(){
	    		//commonQuery.getPluginObj("querygrid").setHeight(commonQuery.getTab().find(".modal_content").height() - 102 - commonQuery.getTab().find(".jl_screening").height());
		});

}

});

commonQuery.query = function(json){
	    commonQuery.readData();
	var data = commonQuery.getData();
	delete data["querygrid"];
	delete data["jlbh"];
	var sqlMap = JLQuery["config"]["sqlMap"];
	var XmlData = JLQuery["config"]["modalField"];
	$.extend(XmlData, data);
	if(!JL.isNull(json)){
		$.extend(XmlData, json);
	}
	$.extend(XmlData, userInfo);
	
	console.info(XmlData);
	XmlData["dataType"] = "Json";
	XmlData["sqlid"] = sqlMap.sqlid;
	XmlData["DataBaseType"] = sqlMap.DataBaseType;
	//XmlData["PCRM_CZY02"] = "00019999";
	
	var src = "";
	if(!JL.isNull(sqlMap.collection)){
		XmlData["collection"] = sqlMap.collection;
		XmlData["result"] = {};
		for (var i = 0; i < sqlMap.result.length; i++) {
			var row = sqlMap.result[i];
			XmlData["result"][row.id] = 1;
		}
	
		src = pubJson.getURL("FormUrl")+"/jlquery/selectMongo.do?rid="+Math.random();
	}else{
		src = pubJson.getURL("FormUrl")+"/jlquery/select.do?rid="+Math.random();
	}

	var ajaxJson = {};
	ajaxJson["src"] = src;
	ajaxJson["data"] = {"XmlData":JSON.stringify(XmlData)};
	var resultData = JL.ajax(ajaxJson,true);
	if(!JL.isNull(resultData)){
		$("#d_querygrid").empty();
		var fileName = resultData.fileName;
		console.info(fileName);
		resultData = resultData.data;
		console.log(commonQuery.getPluginObj("querygrid"))
		commonQuery.getPluginObj("querygrid").setData(resultData);
		console.log(resultData)
		//commonQuery.getPluginObj("querygrid").setPaging(fileName);
	}
}

commonQuery.callback = function(data){
	
	JLQuery.close([data]);
}

</script>
<!-- <div class="max_modal_main">
<div class="modal_content">
		<div id="queryField" class="w12 jl_screening hide">
    		<ul><li class="w12"></li></ul>
  		</div>
		<div id="customPage"></div>
        主体内容         
        <div id="d_querygrid" class="jl_list_04"></div>
        <div id="d_detailgrid" class="w12 hide"></div>
	</div>
</div> -->

<div class="max_modal_main">
<div class="modal_content">
		<div id="queryField" class="w12 jl_screening hide">
    		<ul><li class="w12"></li></ul>
  		</div>
		<div id="customPage"></div>
        <!--主体内容-->         
        
        <div class="w12 jl_list">
        <div class="jl_list_04">
        <div id="d_querygrid" class="list_case"></div>
        </div>
        </div>
        
        <div id="d_detailgrid" class="w12 hide"></div>
	</div>
</div>

<!--  <button onclick="commonQuery.callback()">确定</button>-->
