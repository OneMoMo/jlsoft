<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="GYSWLMXZ">
	<select id="queryGYSWLMXZ" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT A.GSXX01, 
       (SELECT GSXX02 FROM GSXX WHERE GSXX01 = A.GSXX01) GSMC, 
       A.BM01, 
       A.WLDW01, 
       B.BM02 BMMC, 
       W.WLDW02 GYSMC, 
        round(NVL(A.DWYE01, 0),2) HKYE,
       NVL(A.DWYE02, 0)YFKYE,
       round(NVL((A.DWYE01 - A.DWYE02), 0),2)  YFYE,
       round(NVL(A.DWYE08, 0),2) SRYE,
       round(NVL(A.DWYE07, 0),2) FPYE,
       round(NVL((A.DWYE01 - A.DWYE02 - A.DWYE07), 0),2) CWYE,
       round(NVL((A.DWYE01 - A.DWYE02 - A.DWYE10 - A.DWYE08), 0)) YE, 
       NVL((A.DWYE01 - A.DWYE02 - A.DWYE10 - A.DWYE08), 0) YE,DECODE(W.WLDW21,0,'一般往来',1,'内部往来')  WLMX 
  FROM DWYEZ A, BM B, WLDW W 
 WHERE A.BM01 = B.BM01 
   AND A.WLDW01 = W.WLDW01
		   JL{CZY|A.WLDW01|WLDW_CX|inS}JL
       	   JL{CZY|A.BM01|BM_CX|LIKE%}JL
           JL{CZY|A.GSXX01|CZGS_CX|LIKE%}JL
          <if test="WLDW != null and WLDW != ''">
		     <foreach item="item" index="index" collection="WLDW"  open=" AND (" separator=" or " close=")"> 
		      W.WLDW02 LIKE '%'||#{item}||'%' OR A.WLDW01 LIKE '%'||#{item}||'%' OR W.WLDW03 LIKE '%'||#{item}||'%'
		     </foreach> 
	    </if>
	    <if test="CGBM != null and CGBM != ''">
			 <foreach item="item" index="index" collection="CGBM"  open=" AND (" separator=" or " close=")"> 
	          B.BM01 LIKE #{item}||'%'
	    	 </foreach>
	    </if>
	    <if test="WLMX != null and WLMX != ''">
	       AND   W.WLDW21 = #{WLMX}
	    </if>
	    <!--  <if test="YFKE != null and YFKE != ''">
	       AND   (A.DWYE01 - A.DWYE02 - A.DWYE10)=0
	    </if> -->	
	    <if test="YFKE == null ">
	       AND   (A.DWYE01 - A.DWYE02 - A.DWYE10)!=0
	    </if>			 
	</select>
</mapper>