<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="YFKD">

	<select id="queryYFKD" parameterType="Map" resultType="java.util.Map">
		SELECT distinct A.JLWBDH SQDH,
		A.YFKSQD03 SQJE,
		A.WLDW01 GYSDM,
		W.WLDW02 GYSMC,
		(SELECT BM02 FROM BM WHERE BM01 = A.BM01) CGBMMC,
		<!-- (SELECT SPFL02 FROM SPFL WHERE SPFL.SPFL01 = S.SPFL01) SPFL, (SELECT 
			PPB02 FROM PPB WHERE PPB01 = S.PPB01) SPPP, -->
		A.YFKSQD02 SQR,
		A.YFKSQD04 ZDR,
		TO_CHAR(A.YFKSQD05,'YYYY-MM-DD') ZDRQ,
		A.YFKSQD06 SHR,
		TO_CHAR(A.YFKSQD07,'YYYY-MM-DD') SHRQ,
		A.YFKSQD09 BZ,
		A.YFKSQD13 YFJE,
		A.PKJE PKJE,
		A.YFKSQD19 DJJE,
		A.YFKSQD20 HXJE,
		A.YFKSQD14 ZZR,
		TO_CHAR(A.YFKSQD15,'YYYY-MM-DD') ZZRQ,
		C.YFKSQDI01 DHDH,
		C.YFKSQDI02 DHJE,
		A.YFKSQD28 CWRQ
		FROM YFKSQDITEM C, YFKSQD A, WLDW W
		WHERE A.WLDW01 = W.WLDW01
		AND A.GSXX01 = C.GSXX01(+)
		AND A.YFKSQD01 = C.YFKSQD01(+)
		<if test="GSXX01 != null and GSXX01 != ''">
			AND A.GSXX01 = #{GSXX01}
		</if>
		<if test="GYS != null and GYS != ''">
			AND ( W.WLDW02 LIKE '%'||#{GYS}||'%' OR
			W.WLDW03 LIKE '%'||#{GYS}||'%')
		</if>
		<if test="CGBM != null and CGBM != ''">
			<foreach item="item" index="index" collection="CGBM" open=" AND ("
				separator=" or " close=")">
				A.BM01 LIKE #{item}||'%'
			</foreach>
		</if>
		<if test="SQDM != null and SQDM != ''">
			<foreach item="item" index="index" collection="SQDM" open=" AND ("
				separator=" or " close=")">
				A.YFKSQD01 = #{item}
			</foreach>
		</if>
		<if test="SPFL != null and SPFL != ''">
			
			and	exists
            (select 1
          from dhditem, spxx,YFKSQD
         where dhd01 = yfksqdi01
           and dhditem.gsxx01 = YFKSQD.gsxx01
           and spxx.spxx01 = dhditem.spxx01 and spxx.SPFL01=#{SPFL})
			
		</if>

		<if test="ZDRQQ !=null and ZDRQQ != ''">
			AND ((A.YFKSQD05 = TO_DATE(#{ZDRQQ}, 'YYYY-MM-DD') - 1 AND A.YFKSQD05
			IS NULL) OR 
      <![CDATA[ 
        A.YFKSQD05 >= TO_DATE(#{ZDRQQ}, 'YYYY-MM-DD'))
      ]]>
		</if>
		<if test="ZDRQE !=null and ZDRQE != ''">
      <![CDATA[ 
       AND (A.YFKSQD05 <= TO_DATE(#{ZDRQE}, 'YYYY-MM-DD') OR 
      ]]>
			(A.YFKSQD05 IS NULL AND A.YFKSQD05 = TO_DATE(#{ZDRQE},
			'YYYY-MM-DD')))
		</if>
		<if test="HZFS != null and HZFS != ''">
			AND A.HZFS01 = #{HZFS}
		</if>
		<if test="PP != null and PP != ''">	
			AND exists
            (select 1
          from dhditem, spxx,YFKSQD
         where dhd01 = yfksqdi01
           and dhditem.gsxx01 = YFKSQD.gsxx01
           and spxx.spxx01 = dhditem.spxx01 and spxx.PPB01=#{PP})
		</if>

		<if test="SHRQQ !=null and SHRQQ != ''">
			AND ((A.YFKSQD07= TO_DATE(#{SHRQQ}, 'YYYY-MM-DD') - 1 AND A.YFKSQD07
			IS NULL) OR 
      <![CDATA[ 
        A.YFKSQD07 >= TO_DATE(#{SHRQQ}, 'YYYY-MM-DD'))
      ]]>
		</if>
		<if test="SHRQE !=null and SHRQE != ''">
      <![CDATA[ 
       AND (A.YFKSQD07 <= TO_DATE(#{SHRQE}, 'YYYY-MM-DD') OR 
      ]]>
			(A.YFKSQD07 IS NULL AND A.YFKSQD07 = TO_DATE(#{SHRQE},
			'YYYY-MM-DD')))
		</if>
		<if test="ZDR != null and ZDR != ''">
		<foreach item="item" index="index" collection="ZDR"  open=" AND (" separator=" or " close=")"> 
			( A.YFKSQD04  LIKE '%'||#{item}||'%' OR A.YFKSQD23 LIKE '%'||#{item}||'%')
		</foreach>
		</if>
		<if test="SHR != null and SHR != ''">
			<foreach item="item" index="index" collection="SHR"  open=" AND (" separator=" or " close=")"> 
			( A.YFKSQD06  LIKE '%'||#{item}||'%' OR A.YFKSQD24 LIKE '%'||#{item}||'%')
		</foreach>
		</if>
		<if test="SQDH != null and SQDH != ''">
			<foreach item="item" index="index" collection="SQDH" open=" AND ("
				separator=" or " close=")">
				A.JLWBDH LIKE '%'||#{item}||'%'
			</foreach>
		</if>
		JL{CZY|A.WLDW01|WLDW_CZ|inS}JL
		JL{CZY|A.BM01|BM_CZ|LIKE%}JL
		JL{CZY|A.GSXX01|CZGS_CZ|LIKE%}JL

	</select>
</mapper> 