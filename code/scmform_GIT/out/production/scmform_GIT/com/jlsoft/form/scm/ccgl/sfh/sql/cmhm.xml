<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CMHM">
	<select id="YCM" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT A.JQM01, A.JQMK06 DJLX, GET_DJLX(A.JQMK06) DJLX01,  A.CK01, (SELECT CK02 FROM CK WHERE CK01 = A.CK01) CKMC,
			   A.SPXX01, S.SPXX02 SPBM, S.SPXX04 SPMC,
		       (CASE WHEN A.JQMK06=51 THEN (SELECT DISTINCT JLWBDH FROM DSFHPSB WHERE GSXX01=A.GSXX01 AND THDH=A.JQMK07) ELSE GET_JLWBDH_TD(A.JQMK06, A.JQMK07, A.GSXX01) END) JLWBDH,
		       (CASE WHEN A.JQMK06 = 8 THEN
		       (SELECT PFD44 FROM PFD WHERE GSXX01 = A.GSXX01 AND PFD01 = SUBSTRING(A.JQMK07,0,LENGTH(A.JQMK07) - 2)) 
		       WHEN A.JQMK06 = 9 THEN
		       (SELECT WBLXDH FROM YFD WHERE GSXX01 = A.GSXX01 AND YFD01 = SUBSTRING(A.JQMK07,0,LENGTH(A.JQMK07) - 2))
		       WHEN A.JQMK06 = 10 THEN
		       (SELECT SJH FROM VIP_HYXFJL WHERE GSXX01 = A.GSXX01 AND DJBH = A.JQMK07 AND DJLX = 10 AND ROWNUM = 1)
		       END) LXDH,
		       (CASE WHEN A.JQMK06 = 8 THEN
		       (SELECT W.WLDW02 FROM PFD P, WLDW W WHERE P.GSXX01 = A.GSXX01 AND P.PFD01 = SUBSTRING(A.JQMK07,0,LENGTH(A.JQMK07) - 2) AND P.WLDW01 = W.WLDW01) 
		       WHEN A.JQMK06 = 9 THEN
		       (SELECT W.WLDW02 FROM YFD Y, WLDW W WHERE Y.GSXX01 = A.GSXX01 AND Y.YFD01 = SUBSTRING(A.JQMK07,0,LENGTH(A.JQMK07) - 2) AND Y.WLDW01 = W.WLDW01)
		       WHEN A.JQMK06 = 10 THEN
		       (SELECT CAST(HYMC AS NVARCHAR2(255)) FROM VIP_HYXFJL WHERE GSXX01 = A.GSXX01 AND DJBH = A.JQMK07 AND DJLX = 10 AND ROWNUM = 1)
		       WHEN A.JQMK06 = 51 THEN
               (SELECT W.WLDW02 FROM JHD J, WLDW W WHERE J.WLDW01=W.WLDW01 AND J.GSXX01 = A.GSXX01 AND J.JHD01 = A.JQMK07)
		       END) KHMC
		  FROM JQMCK A, SPXX S
		 WHERE A.SPXX01 = S.SPXX01
		   AND A.JQMK06 IN (8,9,10,51)
		   AND A.GSXX01 = #{PCRM_GSXX01}
		<if test="CM != null and CM != ''"> 
		   AND A.JQM01 = #{CM}
		</if>
		<if test="JLWBDH != null and JLWBDH != ''"> 
		   AND GET_JLWBDH_TD(A.JQMK06,A.JQMK07,A.GSXX01) = #{JLWBDH}
		</if>
	</select>
	
	<select id="XCM" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT JQM01, CK01, SPXX01,(SELECT GET_JLCONF_F(100, #{PCRM_GSXX01}) FROM DUAL)CS100,
		(SELECT SPXX46 FROM SPXX WHERE SPXX01=#{SPXX01})CMT,JQMK01
		  FROM JQMKC 
		 WHERE (SELECT GET_JLCONF_F(100, #{PCRM_GSXX01}) FROM DUAL)=1
		   AND GSXX01 = #{PCRM_GSXX01}
		<if test="CM != null and CM != ''"> 
  		   AND JQM01 = #{CM}
		</if>
		UNION ALL 
		SELECT JQM01, CK01, SPXX01,(SELECT GET_JLCONF_F(100, #{PCRM_GSXX01}) FROM DUAL)CS100,
		(SELECT SPXX46 FROM SPXX WHERE SPXX01=#{SPXX01})CMT,JQMK01
		  FROM JQMCK 
		 WHERE (SELECT GET_JLCONF_F(100, #{PCRM_GSXX01}) FROM DUAL)=0
		   AND GSXX01 = #{PCRM_GSXX01}
		<if test="CM != null and CM != ''"> 
  		   AND JQM01 = #{CM}
		</if>
		UNION ALL 
	    SELECT NULL JQM01,NULL CK01,NULL SPXX01,(SELECT GET_JLCONF_F(100, #{PCRM_GSXX01}) FROM DUAL)CS100,
	    (SELECT SPXX46 FROM SPXX WHERE SPXX01=#{SPXX01})CMT,NULL JQMK01 FROM DUAL
	</select>
</mapper>