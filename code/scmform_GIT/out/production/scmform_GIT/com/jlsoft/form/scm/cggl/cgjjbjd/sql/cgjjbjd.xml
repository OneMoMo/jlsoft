<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CGJJBJD">

	<select id="queryCGJJBJD" parameterType="java.util.Map"
		resultType="java.util.Map">

		SELECT A.GSXX01 GSXX01,A.JLWBDH CGBJDH,GET_BJLX(A.JJBJ15)BJLX,
		A.SPXX01,S.SPXX02 SPBM,S.SPXX04 SPMC,A.JJBJ02 PCH,
		ROUND(A.JJBJ05*(1+W.JXSL01),2) YJHDJ,ROUND(A.JJBJ06*(1+W.JXSL01),2)
		XJHDJ,A.JJBJ07 TXSSL,ROUND(A.JJBJ13*(1+W.JXSL01),2) TCBJE,A.JJBJ08
		TKCSL,ROUND(A.JJBJ08*(A.JJBJ06-A.JJBJ05)*(1+W.JXSL01),2) TKCJE,
		A.JJBJ10 TSYSL,ROUND(A.JJBJ10*(A.JJBJ06-A.JJBJ05)*(1+W.JXSL01),2)
		TSYJE,A.JJBJ16 BZ,A.WLDW01,A.BM01,GET_ZZFS(A.ZZFS01)ZZFS,
		(SELECT
		WLDW02 FROM WLDW WHERE WLDW01 = A.WLDW01) WLDWMC,A.JJBJ17 ZDR,(SELECT
		PPB02 FROM PPB WHERE PPB01 = S.PPB01)SPPP01,
		(SELECT BM02 FROM BM WHERE
		BM01 = A.BM01)
		BMMC,TO_CHAR(A.JJBJ18,'YYYY-MM-DD') ZDRQ
		FROM JJBJD
		A,SPXX S,WLDW W
		WHERE A.SPXX01 = S.SPXX01
		AND A.WLDW01 = W.WLDW01
		
		<if test="SPMC != null and SPMC != ''">
			<foreach item="item" index="index" collection="SPMC" open=" AND ("
				separator=" or " close=")">
				Upper(S.SPXX02) LIKE Upper(
				'%'||#{item}||'%') OR Upper(S.SPXX04) LIKE
				Upper('%'||#{item}||'%')
				OR Upper(S.SPPYM) LIKE
				Upper('%'||#{item}||'%')
			</foreach>
		</if>

		<if test="BMMC != null and BMMC !=''">
			<foreach item="item" index="index" collection="BMMC" open=" AND ("
				separator=" or " close=")">
				A.BM01 = #{item}
			</foreach>
		</if>
		<if test="BJLX != null and BJLX !=''">
			AND A.JJBJ15 = #{BJLX}
		</if>
		<if test="GSXX01 != null and GSXX01 !=''">
			AND A.GSXX01 = #{GSXX01}
		</if>
		<if test="WLDWMC != null and WLDWMC !=''">
			<foreach item="item" index="index" collection="WLDWMC" open=" AND ("
				separator=" or " close=")">
				Upper((SELECT WLDW02 FROM WLDW WHERE WLDW01 = A.WLDW01)) LIKE Upper(
				'%'||#{item}||'%') OR Upper(A.WLDW01) LIKE Upper('%'||#{item}||'%')
			</foreach>
			
		</if>

		<if test="SPPP01 != null and SPPP01 !=''">
			<foreach item="item" index="index" collection="SPPP01" open=" AND ("
				separator=" or " close=")">
				S.PPB01 = #{item}
			</foreach>
		</if>

		<if test="CGBJDH != null and CGBJDH !=''">
			<foreach item="item" index="index" collection="CGBJDH" open=" AND ("
				separator=" or " close=")">
				A.JLWBDH LIKE '%'||#{item}||'%'
			</foreach>
		</if>

		<if test="ZDRQ_S != null and ZDRQ_S !=''">
		    <![CDATA[AND A.JJBJ18 >= TO_DATE(#{ZDRQ_S},'YYYY-MM-DD')]]>
		</if>

		<if test="ZDRQ_E != null and ZDRQ_E !=''">
		    <![CDATA[AND A.JJBJ18 <= TO_DATE(#{ZDRQ_E},'YYYY-MM-DD')]]>
		</if>


		JL{CZY|A.BM01|BM_CX|LIKE%}JL
		JL{CZY|A.WLDW01|WLDW_CX|inS}JL
		

	</select>
</mapper>